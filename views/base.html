<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{% block title %}Meu Site{% endblock %}</title>

  <!-- CSS global -->
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">

  <!-- Ionicons v4 -->
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

  {% block head %}{% endblock %}
</head>
<body>
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-messages">
      {% for category, message in messages %}
        <div class="flash {{ category }}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

  <header>
    <div class="container header-content">
      <div class="brand">
        <div class="logo-placeholder"><img src="{{ url_for('static', filename='img/JSGlogo.png') }}" class="logo-img" alt="Logo"></div>
        <span class="brand-name">JustSetGo</span>
      </div>
      <button class="sidebar-toggle" id="sidebarToggle" aria-label="Abrir menu lateral" aria-controls="appSidebar" aria-expanded="false">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
      <div class="search-container">
        <form class="search-bar" action="#" method="get" role="search" aria-label="Pesquisar">
          <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"/>
            <path d="M20 20l-3.2-3.2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <input type="search" name="q" placeholder="Pesquisar eventos, destinos, datas..." aria-label="Campo de busca">
        </form>
      </div>
      <nav class="nav-container">
        {% block nav %}{% endblock %}
        <button class="theme-toggle" id="themeToggle" aria-label="Alternar tema">
          <svg class="theme-icon sun" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2"/>
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2"/>
          </svg>
          <svg class="theme-icon moon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>
        <a href="{{ url_for('perfil') }}" class="nav-link profile-link" aria-label="Perfil">
          <img class="profile-avatar" img src="{{ user.profileImage }}" alt="Avatar">
        </a>
      </nav>
    </div>
  </header>

  <main>
    <hr>
    {% block content %}{% endblock %}
    <hr>
  </main>

  <!-- Overlay para fechar a sidebar -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Sidebar -->
  <aside class="sidebar" id="appSidebar" aria-hidden="true">
    <div class="sidebar-header">
      <span class="sidebar-title">Menu</span>
      <button class="sidebar-close" id="sidebarClose" aria-label="Fechar menu">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    <nav class="sidebar-nav">
      <a href="{{ url_for('home') }}" class="sidebar-link">
        <ion-icon name="home-outline"></ion-icon>
        <span>Início</span>
      </a>
      <a href="{{ url_for('agenda') }}" class="sidebar-link">
        <ion-icon name="calendar-outline"></ion-icon>
        <span>Agenda</span>
      </a>
      <a href="{{ url_for('my_chats') }}" class="sidebar-link">
        <ion-icon name="chatbubbles-outline"></ion-icon>
        <span>Meus Chats</span>
      </a>
      <a href="{{ url_for('perfil') }}" class="sidebar-link">
        <ion-icon name="person-outline"></ion-icon>
        <span>Perfil</span>
      </a>
      <a href="{{ url_for('new_event') }}" class="sidebar-link">
        <ion-icon name="list-outline"></ion-icon>
        <span>Eventos</span>
      </a>
    </nav>
  </aside>

  <footer>
    <!-- rodapé se quiser -->
  </footer>

  <!-- espaço para scripts que cada template pode injetar -->
  {% block scripts %}{% endblock %}
  
  <!-- Script do toggle de tema e sidebar -->
  <script>
    // Sistema de toggle de tema e sidebar
    (function() {
      const themeToggle = document.getElementById('themeToggle');
      const sidebarToggle = document.getElementById('sidebarToggle');
      const htmlElement = document.documentElement;
      
      // Função para aplicar o tema
      function applyTheme(theme) {
        htmlElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
      }
      
      // Função para alternar tema
      function toggleTheme() {
        const currentTheme = htmlElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        applyTheme(newTheme);
      }
      
      // Carregar tema salvo ou usar preferência do sistema
      function loadTheme() {
        const savedTheme = localStorage.getItem('theme');
        const systemPreference = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        const theme = savedTheme || systemPreference;
        applyTheme(theme);
      }
      
      // Função para alternar sidebar
      function toggleSidebar(btn) {
        const isOpen = document.body.classList.toggle('sidebar-open');
        const sidebar = document.getElementById('appSidebar');
        const overlay = document.getElementById('sidebarOverlay');
        
        if (btn) btn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
        if (sidebar) sidebar.setAttribute('aria-hidden', isOpen ? 'false' : 'true');
        
        // Prevenir scroll do body quando sidebar aberta
        if (isOpen) {
          document.body.style.overflow = 'hidden';
        } else {
          document.body.style.overflow = '';
        }
      }
      
      // Função para fechar sidebar
      function closeSidebar() {
        document.body.classList.remove('sidebar-open');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('appSidebar');
        
        if (sidebarToggle) sidebarToggle.setAttribute('aria-expanded', 'false');
        if (sidebar) sidebar.setAttribute('aria-hidden', 'true');
        
        // Restaurar scroll do body
        document.body.style.overflow = '';
      }
      
      // Event listeners para tema
      if (themeToggle) {
        themeToggle.addEventListener('click', toggleTheme);
      }
      
      // Event listeners para abrir sidebar
      if (sidebarToggle) {
        sidebarToggle.addEventListener('click', () => toggleSidebar(sidebarToggle));
      }
      
      // Event listeners para fechar sidebar
      const sidebarClose = document.getElementById('sidebarClose');
      const sidebarOverlay = document.getElementById('sidebarOverlay');
      
      if (sidebarClose) {
        sidebarClose.addEventListener('click', closeSidebar);
      }
      
      if (sidebarOverlay) {
        sidebarOverlay.addEventListener('click', closeSidebar);
      }
      
      // Fechar sidebar ao pressionar ESC
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && document.body.classList.contains('sidebar-open')) {
          closeSidebar();
        }
      });
      
      // Escutar mudanças na preferência do sistema
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        if (!localStorage.getItem('theme')) {
          applyTheme(e.matches ? 'dark' : 'light');
        }
      });
      
      // Inicializar tema
      loadTheme();
    })();
  </script>
</body>
</html>
