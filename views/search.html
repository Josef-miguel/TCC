{% extends "base.html" %}

{% block title %}Pesquisar Viagens - JustSetGo{% endblock %}

{% block content %}
<div class="container">
  <div class="search-page">
    <!-- Barra de pesquisa principal -->
    <div class="search-section">
      <div class="search-header">
        <h1>Pesquisar Viagens</h1>
        <p>Encontre a viagem perfeita para você</p>
      </div>
      
      <div class="main-search-bar">
        <form class="search-form" id="searchForm">
          <div class="search-input-group">
            <input 
              type="search" 
              id="searchInput" 
              name="q" 
              placeholder="Pesquisar por destino, evento, organizador..." 
              aria-label="Campo de busca"
              autocomplete="off"
            >
            <button type="button" class="filter-btn" id="filterBtn" aria-label="Abrir filtros">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M22 12h-4l-3 9L9 3l-3 9H2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <button type="submit" class="search-btn" aria-label="Pesquisar">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Filtros aplicados -->
    <div class="applied-filters" id="appliedFilters" style="display: none;">
      <div class="filters-header">
        <span>Filtros aplicados:</span>
        <button type="button" class="clear-filters-btn" id="clearFiltersBtn">Limpar todos</button>
      </div>
      <div class="filter-tags" id="filterTags"></div>
    </div>

    <!-- Sistema de Abas -->
    <div class="tabs-container">
      <div class="tabs-header">
        <button class="tab-button active" id="tripsTab" data-tab="trips">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" stroke="currentColor" stroke-width="2"/>
            <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2"/>
          </svg>
          Viagens
        </button>
        <button class="tab-button" id="usersTab" data-tab="users">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
            <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
          </svg>
          Usuários
        </button>
      </div>

      <!-- Conteúdo da aba Viagens -->
      <div class="tab-content active" id="tripsContent">
        <div class="search-results">
          <div class="results-header" id="resultsHeader" style="display: none;">
            <h2 id="resultsTitle">Resultados da pesquisa</h2>
            <div class="results-count" id="resultsCount"></div>
          </div>
          
          <div class="results-grid" id="resultsGrid">
            <!-- Os resultados serão inseridos aqui via JavaScript -->
          </div>
          
          <div class="no-results" id="noResults" style="display: none;">
            <div class="no-results-content">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"/>
                <path d="M20 20l-3.2-3.2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              <h3>Nenhum resultado encontrado</h3>
              <p>Tente ajustar seus filtros ou usar termos de pesquisa diferentes.</p>
            </div>
          </div>
          
          <div class="loading" id="loading" style="display: none;">
            <div class="loading-spinner"></div>
            <p>Pesquisando...</p>
          </div>
        </div>
      </div>

      <!-- Conteúdo da aba Usuários -->
      <div class="tab-content" id="usersContent">
        <div class="search-results">
          <div class="results-header" id="usersResultsHeader" style="display: none;">
            <h2 id="usersResultsTitle">Usuários encontrados</h2>
            <div class="results-count" id="usersResultsCount"></div>
          </div>
          
          <div class="users-grid" id="usersGrid">
            <!-- Os usuários serão inseridos aqui via JavaScript -->
          </div>
          
          <div class="no-results" id="usersNoResults" style="display: none;">
            <div class="no-results-content">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
                <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
              </svg>
              <h3>Nenhum usuário encontrado</h3>
              <p>Tente usar termos de pesquisa diferentes.</p>
            </div>
          </div>
          
          <div class="loading" id="usersLoading" style="display: none;">
            <div class="loading-spinner"></div>
            <p>Pesquisando usuários...</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Filtros -->
<div class="modal-overlay" id="filterModalOverlay">
  <div class="modal" id="filterModal">
    <div class="modal-header">
      <h2>Filtros de Pesquisa</h2>
      <button type="button" class="modal-close" id="closeFilterModal" aria-label="Fechar modal">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    
    <div class="modal-content">
      <form id="filterForm">
        <!-- Filtro por Tags -->
        <div class="filter-group">
          <label for="tagsFilter">Tags</label>
          <div class="tags-filter-container">
            <div class="tags-checkboxes">
              <label class="tag-checkbox">
                <input type="checkbox" name="tags" value="relaxante">
                <span class="tag-label">Relaxante</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" name="tags" value="aventura">
                <span class="tag-label">Aventura</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" name="tags" value="acao">
                <span class="tag-label">Ação</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" name="tags" value="cultural">
                <span class="tag-label">Cultural</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" name="tags" value="gastronomia">
                <span class="tag-label">Gastronomia</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" name="tags" value="natureza">
                <span class="tag-label">Natureza</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" name="tags" value="esportes">
                <span class="tag-label">Esportes</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" name="tags" value="praia">
                <span class="tag-label">Praia</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" name="tags" value="montanha">
                <span class="tag-label">Montanha</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" name="tags" value="cidade">
                <span class="tag-label">Cidade</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" name="tags" value="romantico">
                <span class="tag-label">Romântico</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" name="tags" value="familia">
                <span class="tag-label">Família</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Filtro por Preço -->
        <div class="filter-group">
          <label for="priceFilter">Faixa de Preço</label>
          <select id="priceFilter" name="price">
            <option value="">Qualquer preço</option>
            <option value="0-100">Até R$ 100</option>
            <option value="100-300">R$ 100 - R$ 300</option>
            <option value="300-500">R$ 300 - R$ 500</option>
            <option value="500-1000">R$ 500 - R$ 1.000</option>
            <option value="1000+">Acima de R$ 1.000</option>
          </select>
        </div>

        <!-- Filtro por Rating (para implementação futura) -->
        <div class="filter-group">
          <label for="ratingFilter">Avaliação Mínima</label>
          <select id="ratingFilter" name="rating" disabled>
            <option value="">Qualquer avaliação</option>
            <option value="4">4+ estrelas</option>
            <option value="3">3+ estrelas</option>
            <option value="2">2+ estrelas</option>
            <option value="1">1+ estrelas</option>
          </select>
          <small class="filter-note">Em breve: sistema de avaliações</small>
        </div>

        <!-- Filtro por Data -->
        <div class="filter-group">
          <label for="dateFilter">Data de Saída</label>
          <input type="date" id="dateFilter" name="date">
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" id="resetFiltersBtn">Limpar Filtros</button>
      <button type="button" class="btn btn-primary" id="applyFiltersBtn">Aplicar Filtros</button>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchForm = document.getElementById('searchForm');
  const searchInput = document.getElementById('searchInput');
  const filterBtn = document.getElementById('filterBtn');
  const filterModal = document.getElementById('filterModal');
  const filterModalOverlay = document.getElementById('filterModalOverlay');
  const closeFilterModal = document.getElementById('closeFilterModal');
  const applyFiltersBtn = document.getElementById('applyFiltersBtn');
  const resetFiltersBtn = document.getElementById('resetFiltersBtn');
  const clearFiltersBtn = document.getElementById('clearFiltersBtn');
  const resultsGrid = document.getElementById('resultsGrid');
  const resultsHeader = document.getElementById('resultsHeader');
  const resultsTitle = document.getElementById('resultsTitle');
  const resultsCount = document.getElementById('resultsCount');
  const noResults = document.getElementById('noResults');
  const loading = document.getElementById('loading');
  const appliedFilters = document.getElementById('appliedFilters');
  const filterTags = document.getElementById('filterTags');

  // Elementos das abas
  const tripsTab = document.getElementById('tripsTab');
  const usersTab = document.getElementById('usersTab');
  const tripsContent = document.getElementById('tripsContent');
  const usersContent = document.getElementById('usersContent');
  
  // Elementos da busca de usuários
  const usersGrid = document.getElementById('usersGrid');
  const usersResultsHeader = document.getElementById('usersResultsHeader');
  const usersResultsTitle = document.getElementById('usersResultsTitle');
  const usersResultsCount = document.getElementById('usersResultsCount');
  const usersNoResults = document.getElementById('usersNoResults');
  const usersLoading = document.getElementById('usersLoading');

  let currentFilters = {};
  let searchResults = [];
  let currentTab = 'trips';

  // Função para mostrar/ocultar loading
  function showLoading(show) {
    loading.style.display = show ? 'block' : 'none';
  }

  // Função para mostrar/ocultar loading de usuários
  function showUsersLoading(show) {
    usersLoading.style.display = show ? 'block' : 'none';
  }

  // Função para alternar entre abas
  function switchTab(tabName) {
    // Atualizar botões das abas
    tripsTab.classList.toggle('active', tabName === 'trips');
    usersTab.classList.toggle('active', tabName === 'users');
    
    // Atualizar conteúdo das abas
    tripsContent.classList.toggle('active', tabName === 'trips');
    usersContent.classList.toggle('active', tabName === 'users');
    
    currentTab = tabName;
    
    // Realizar busca na aba ativa
    if (searchInput.value.trim()) {
      if (tabName === 'trips') {
        performSearch(searchInput.value.trim(), currentFilters);
      } else {
        performUsersSearch(searchInput.value.trim());
      }
    }
  }

  // Função para realizar busca de viagens
  async function performSearch(query = '', filters = {}) {
    showLoading(true);
    hideResults();

    try {
      const params = new URLSearchParams();
      if (query) params.append('q', query);
      
      // Adicionar filtros aos parâmetros
      Object.keys(filters).forEach(key => {
        if (filters[key]) {
          if (key === 'tags' && Array.isArray(filters[key])) {
            // Para tags, adicionar cada uma como parâmetro separado
            filters[key].forEach(tag => params.append('tags', tag));
          } else {
            params.append(key, filters[key]);
          }
        }
      });

      const response = await fetch(`/search_api?${params.toString()}`);
      const data = await response.json();

      if (data.success) {
        searchResults = data.results || [];
        displayResults(searchResults, query);
      } else {
        console.error('Erro na busca:', data.message);
        showNoResults();
      }
    } catch (error) {
      console.error('Erro ao realizar busca:', error);
      showNoResults();
    } finally {
      showLoading(false);
    }
  }

  // Função para realizar busca de usuários
  async function performUsersSearch(query = '') {
    showUsersLoading(true);
    hideUsersResults();

    try {
      const params = new URLSearchParams();
      if (query) params.append('q', query);

      const response = await fetch(`/search_users_api?${params.toString()}`);
      const data = await response.json();

      if (data.success) {
        displayUsersResults(data.results || [], query);
      } else {
        console.error('Erro na busca de usuários:', data.message);
        showUsersNoResults();
      }
    } catch (error) {
      console.error('Erro ao realizar busca de usuários:', error);
      showUsersNoResults();
    } finally {
      showUsersLoading(false);
    }
  }

  // Função para exibir resultados de viagens
  function displayResults(results, query) {
    if (results.length === 0) {
      showNoResults();
      return;
    }

    resultsHeader.style.display = 'block';
    resultsTitle.textContent = query ? `Resultados para "${query}"` : 'Todos os resultados';
    resultsCount.textContent = `${results.length} viagem${results.length !== 1 ? 'ns' : ''} encontrada${results.length !== 1 ? 's' : ''}`;

    resultsGrid.innerHTML = '';
    results.forEach(event => {
      const eventCard = createEventCard(event);
      resultsGrid.appendChild(eventCard);
    });
  }

  // Função para exibir resultados de usuários
  function displayUsersResults(results, query) {
    if (results.length === 0) {
      showUsersNoResults();
      return;
    }

    usersResultsHeader.style.display = 'block';
    usersResultsTitle.textContent = query ? `Usuários encontrados para "${query}"` : 'Todos os usuários';
    usersResultsCount.textContent = `${results.length} usuário${results.length !== 1 ? 's' : ''} encontrado${results.length !== 1 ? 's' : ''}`;

    usersGrid.innerHTML = '';
    results.forEach(user => {
      const userCard = createUserCard(user);
      usersGrid.appendChild(userCard);
    });
  }

  // Função para criar card do evento
  function createEventCard(event) {
    const card = document.createElement('div');
    card.className = 'event-card';
    
    const exitDate = event.exit_date ? new Date(event.exit_date.seconds * 1000) : null;
    const returnDate = event.return_date ? new Date(event.return_date.seconds * 1000) : null;
    
    card.innerHTML = `
      <div class="event-image">
        ${event.images && event.images.length > 0 ? 
          `<img src="${event.images[0]}" alt="${event.title}" loading="lazy">` : 
          '<div class="no-image">Sem imagem</div>'
        }
      </div>
      <div class="event-content">
        <h3 class="event-title">${event.title}</h3>
        <p class="event-description">${event.desc || 'Sem descrição'}</p>
        <div class="event-details">
          <div class="event-date">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
              <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2"/>
              <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2"/>
              <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
            </svg>
            <span>${exitDate ? exitDate.toLocaleDateString('pt-BR') : 'Data não definida'}</span>
          </div>
          <div class="event-price">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <line x1="12" y1="1" x2="12" y2="23" stroke="currentColor" stroke-width="2"/>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" stroke="currentColor" stroke-width="2"/>
            </svg>
            <span>R$ ${event.price ? event.price.toFixed(2) : '0,00'}</span>
          </div>
          <div class="event-slots">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
            </svg>
            <span>${event.numSlots || 0} vagas</span>
          </div>
        </div>
        <div class="event-actions">
          <button class="btn btn-primary" onclick="joinEvent('${event.id}')">Participar</button>
          <button class="btn btn-secondary" onclick="viewEvent('${event.id}')">Ver Detalhes</button>
        </div>
      </div>
    `;
    
    return card;
  }

  // Função para criar card do usuário
  function createUserCard(user) {
    const card = document.createElement('div');
    card.className = 'user-card';
    
    card.innerHTML = `
      <div class="user-avatar">
        ${user.profileImage ? 
          `<img src="${user.profileImage}" alt="${user.name}" loading="lazy">` : 
          '<div class="default-avatar">' + (user.name ? user.name.charAt(0).toUpperCase() : 'U') + '</div>'
        }
      </div>
      <div class="user-content">
        <h3 class="user-name">${user.name || 'Nome não informado'}</h3>
        <p class="user-email">${user.email || 'Email não informado'}</p>
        <div class="user-details">
          <div class="user-role">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2L2 7l10 5 10-5-10-5z" stroke="currentColor" stroke-width="2"/>
              <path d="M2 17l10 5 10-5" stroke="currentColor" stroke-width="2"/>
              <path d="M2 12l10 5 10-5" stroke="currentColor" stroke-width="2"/>
            </svg>
            <span>${user.isOrganizer ? 'Organizador' : 'Participante'}</span>
          </div>
          <div class="user-events-count">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2"/>
            </svg>
            <span>${user.organizedEventsCount || 0} viagens organizadas</span>
          </div>
        </div>
        <div class="user-actions">
          <button class="btn btn-primary" onclick="viewUserProfile('${user.uid}')" data-user-id="${user.uid}">Ver Perfil</button>
        </div>
      </div>
    `;
    
    return card;
  }

  // Função para mostrar "nenhum resultado" de viagens
  function showNoResults() {
    resultsHeader.style.display = 'none';
    resultsGrid.innerHTML = '';
    noResults.style.display = 'block';
  }

  // Função para ocultar resultados de viagens
  function hideResults() {
    resultsHeader.style.display = 'none';
    resultsGrid.innerHTML = '';
    noResults.style.display = 'none';
  }

  // Função para mostrar "nenhum resultado" de usuários
  function showUsersNoResults() {
    usersResultsHeader.style.display = 'none';
    usersGrid.innerHTML = '';
    usersNoResults.style.display = 'block';
  }

  // Função para ocultar resultados de usuários
  function hideUsersResults() {
    usersResultsHeader.style.display = 'none';
    usersGrid.innerHTML = '';
    usersNoResults.style.display = 'none';
  }

  // Função para atualizar filtros aplicados
  function updateAppliedFilters() {
    const hasFilters = Object.values(currentFilters).some(value => value);
    
    if (hasFilters) {
      appliedFilters.style.display = 'block';
      filterTags.innerHTML = '';
      
      Object.keys(currentFilters).forEach(key => {
        if (currentFilters[key]) {
          const tag = document.createElement('span');
          tag.className = 'filter-tag';
          tag.innerHTML = `
            <span>${getFilterLabel(key)}: ${getFilterValue(key, currentFilters[key])}</span>
            <button type="button" onclick="removeFilter('${key}')" aria-label="Remover filtro">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          `;
          filterTags.appendChild(tag);
        }
      });
    } else {
      appliedFilters.style.display = 'none';
    }
  }

  // Função para obter label do filtro
  function getFilterLabel(key) {
    const labels = {
      tags: 'Tags',
      price: 'Preço',
      rating: 'Avaliação',
      date: 'Data'
    };
    return labels[key] || key;
  }

  // Função para obter valor do filtro
  function getFilterValue(key, value) {
    if (key === 'tags' && Array.isArray(value)) {
      return value.join(', ');
    }
    if (key === 'price') {
      const ranges = {
        '0-100': 'Até R$ 100',
        '100-300': 'R$ 100 - R$ 300',
        '300-500': 'R$ 300 - R$ 500',
        '500-1000': 'R$ 500 - R$ 1.000',
        '1000+': 'Acima de R$ 1.000'
      };
      return ranges[value] || value;
    }
    return value;
  }

  // Função para remover filtro
  window.removeFilter = function(key) {
    delete currentFilters[key];
    updateAppliedFilters();
    performSearch(searchInput.value, currentFilters);
  };

  // Função para visualizar perfil do usuário
  window.viewUserProfile = function(userId) {
    console.log('Redirecionando para perfil do usuário:', userId);
    console.log('URL de destino:', `/user/${userId}`);
    window.location.href = `/user/${userId}`;
  };

  // Event listener alternativo para botões de perfil
  document.addEventListener('click', function(e) {
    if (e.target.matches('.btn-primary[data-user-id]')) {
      const userId = e.target.getAttribute('data-user-id');
      console.log('Botão clicado via event listener:', userId);
      viewUserProfile(userId);
    }
  });


  // Event listeners
  searchForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const query = searchInput.value.trim();
    if (currentTab === 'trips') {
      performSearch(query, currentFilters);
    } else {
      performUsersSearch(query);
    }
  });

  filterBtn.addEventListener('click', function() {
    filterModalOverlay.style.display = 'flex';
    document.body.style.overflow = 'hidden';
  });

  closeFilterModal.addEventListener('click', function() {
    filterModalOverlay.style.display = 'none';
    document.body.style.overflow = '';
  });

  filterModalOverlay.addEventListener('click', function(e) {
    if (e.target === filterModalOverlay) {
      filterModalOverlay.style.display = 'none';
      document.body.style.overflow = '';
    }
  });

  applyFiltersBtn.addEventListener('click', function() {
    const formData = new FormData(document.getElementById('filterForm'));
    currentFilters = {};
    
    // Processar tags separadamente
    const tags = [];
    for (let [key, value] of formData.entries()) {
      if (key === 'tags') {
        tags.push(value);
      } else if (value) {
        currentFilters[key] = value;
      }
    }
    
    if (tags.length > 0) {
      currentFilters.tags = tags;
    }
    
    updateAppliedFilters();
    filterModalOverlay.style.display = 'none';
    document.body.style.overflow = '';
    
    performSearch(searchInput.value, currentFilters);
  });

  resetFiltersBtn.addEventListener('click', function() {
    document.getElementById('filterForm').reset();
  });

  clearFiltersBtn.addEventListener('click', function() {
    currentFilters = {};
    updateAppliedFilters();
    performSearch(searchInput.value, currentFilters);
  });

  // Event listeners das abas
  tripsTab.addEventListener('click', function() {
    switchTab('trips');
  });

  usersTab.addEventListener('click', function() {
    switchTab('users');
  });


  // Funções globais para os botões dos cards
  window.joinEvent = function(eventId) {
    // Implementar lógica de participar do evento
    console.log('Participar do evento:', eventId);
  };

  window.viewEvent = function(eventId) {
    // Implementar lógica de visualizar evento
    console.log('Ver detalhes do evento:', eventId);
  };

  // Carregar eventos ao inicializar a página
  // Se houver uma query na URL, usar ela; senão, carregar todos os eventos
  const urlParams = new URLSearchParams(window.location.search);
  const initialQuery = urlParams.get('q') || '';
  const initialTab = urlParams.get('tab') || 'trips';
  
  if (initialQuery) {
    searchInput.value = initialQuery;
  }
  
  // Definir aba inicial
  switchTab(initialTab);
  
  // Realizar busca inicial
  if (initialTab === 'trips') {
    performSearch(initialQuery);
  } else {
    performUsersSearch(initialQuery);
  }
});
</script>

<style>
.search-page {
  padding: 2rem 0;
}

.search-section {
  margin-bottom: 2rem;
}

.search-header {
  text-align: center;
  margin-bottom: 2rem;
}

.search-header h1 {
  font-size: 2.5rem;
  margin-bottom: 0.5rem;
  color: var(--text-primary);
}

.search-header p {
  color: var(--text-secondary);
  font-size: 1.1rem;
}

.main-search-bar {
  max-width: 800px;
  margin: 0 auto;
}

.search-input-group {
  display: flex;
  align-items: center;
  background: var(--bg-secondary);
  border: 2px solid var(--border-color);
  border-radius: 12px;
  padding: 0.75rem;
  transition: border-color 0.3s ease;
}

.search-input-group:focus-within {
  border-color: var(--primary-color);
}

.search-input-group input {
  flex: 1;
  border: none;
  background: transparent;
  font-size: 1rem;
  color: var(--text-primary);
  outline: none;
}

.search-input-group input::placeholder {
  color: var(--text-secondary);
}

.filter-btn, .search-btn {
  background: none;
  border: none;
  padding: 0.5rem;
  cursor: pointer;
  color: var(--text-secondary);
  transition: color 0.3s ease;
  border-radius: 6px;
}

.filter-btn:hover, .search-btn:hover {
  color: var(--primary-color);
  background: var(--bg-hover);
}

.applied-filters {
  background: var(--bg-secondary);
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 2rem;
}

.filters-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.filter-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.filter-tag {
  display: flex;
  align-items: center;
  background: var(--primary-color);
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.875rem;
}

.filter-tag button {
  background: none;
  border: none;
  color: white;
  margin-left: 0.5rem;
  cursor: pointer;
  padding: 0.25rem;
  border-radius: 4px;
}

.filter-tag button:hover {
  background: rgba(255, 255, 255, 0.2);
}

.clear-filters-btn {
  background: none;
  border: none;
  color: var(--primary-color);
  cursor: pointer;
  font-size: 0.875rem;
}

.results-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.results-count {
  color: var(--text-secondary);
  font-size: 0.875rem;
}

.results-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
}

.event-card {
  background: var(--bg-secondary);
  border-radius: 12px;
  overflow: hidden;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  border: 1px solid var(--border-color);
}

.event-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.event-image {
  height: 200px;
  overflow: hidden;
}

.event-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.no-image {
  width: 100%;
  height: 100%;
  background: var(--bg-tertiary);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-secondary);
}

.event-content {
  padding: 1.5rem;
}

.event-title {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: var(--text-primary);
}

.event-description {
  color: var(--text-secondary);
  margin-bottom: 1rem;
  line-height: 1.5;
}

.event-details {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-bottom: 1.5rem;
}

.event-details > div {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--text-secondary);
  font-size: 0.875rem;
}

.event-actions {
  display: flex;
  gap: 0.75rem;
}

.event-actions .btn {
  flex: 1;
  padding: 0.75rem;
  font-size: 0.875rem;
}

.no-results {
  text-align: center;
  padding: 4rem 2rem;
}

.no-results-content svg {
  color: var(--text-secondary);
  margin-bottom: 1rem;
}

.no-results-content h3 {
  margin-bottom: 0.5rem;
  color: var(--text-primary);
}

.no-results-content p {
  color: var(--text-secondary);
}

.loading {
  text-align: center;
  padding: 4rem 2rem;
}

.loading-spinner {
  width: 40px;
  height: 40px;
  border: 4px solid var(--border-color);
  border-top: 4px solid var(--primary-color);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 1rem;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Modal Styles */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal {
  background: var(--bg-primary);
  border-radius: 12px;
  width: 90%;
  max-width: 500px;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1.5rem;
  border-bottom: 1px solid var(--border-color);
}

.modal-header h2 {
  margin: 0;
  color: var(--text-primary);
}

.modal-close {
  background: none;
  border: none;
  cursor: pointer;
  color: var(--text-secondary);
  padding: 0.5rem;
  border-radius: 6px;
}

.modal-close:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
}

.modal-content {
  padding: 1.5rem;
}

.filter-group {
  margin-bottom: 1.5rem;
}

.filter-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: var(--text-primary);
}

.filter-group select,
.filter-group input {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  background: var(--bg-secondary);
  color: var(--text-primary);
  font-size: 1rem;
}

.filter-group select:focus,
.filter-group input:focus {
  outline: none;
  border-color: var(--primary-color);
}

.filter-group select:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.filter-note {
  color: var(--text-secondary);
  font-size: 0.75rem;
  margin-top: 0.25rem;
}

.tags-filter-container {
  max-height: 200px;
  overflow-y: auto;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  padding: 1rem;
  background: var(--bg-secondary);
}

.tags-checkboxes {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 0.75rem;
}

.tag-checkbox {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
  padding: 0.5rem;
  border-radius: 6px;
  transition: background-color 0.2s ease;
}

.tag-checkbox:hover {
  background: var(--bg-hover);
}

.tag-checkbox input[type="checkbox"] {
  margin: 0;
  width: 16px;
  height: 16px;
  accent-color: var(--primary-color);
}

.tag-label {
  font-size: 0.875rem;
  color: var(--text-primary);
  user-select: none;
}

.modal-footer {
  display: flex;
  gap: 1rem;
  padding: 1.5rem;
  border-top: 1px solid var(--border-color);
}

.modal-footer .btn {
  flex: 1;
  padding: 0.75rem;
}

/* Estilos das Abas */
.tabs-container {
  margin-top: 2rem;
}

.tabs-header {
  display: flex;
  background: var(--bg-secondary);
  border-radius: 12px;
  padding: 0.5rem;
  margin-bottom: 2rem;
  gap: 0.5rem;
}

.tab-button {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 1rem;
  background: transparent;
  border: none;
  border-radius: 8px;
  color: var(--text-secondary);
  font-size: 1rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
}

.tab-button:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
}

.tab-button.active {
  background: var(--primary-color);
  color: white;
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

/* Estilos dos Cards de Usuários */
.users-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
}

.user-card {
  background: var(--bg-secondary);
  border-radius: 12px;
  overflow: hidden;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  border: 1px solid var(--border-color);
  padding: 1.5rem;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.user-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.user-avatar {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  overflow: hidden;
  flex-shrink: 0;
}

.user-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.default-avatar {
  width: 100%;
  height: 100%;
  background: var(--primary-color);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  font-weight: 600;
}

.default-avatar.large {
  width: 80px;
  height: 80px;
  font-size: 2rem;
}

.user-content {
  flex: 1;
  min-width: 0;
}

.user-name {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 0.25rem;
  color: var(--text-primary);
}

.user-email {
  color: var(--text-secondary);
  font-size: 0.875rem;
  margin-bottom: 0.75rem;
}

.user-details {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.user-details > div {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--text-secondary);
  font-size: 0.875rem;
}

.user-actions {
  display: flex;
  gap: 0.5rem;
}

.user-actions .btn {
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
}


/* Responsive */
@media (max-width: 768px) {
  .search-header h1 {
    font-size: 2rem;
  }
  
  .results-grid, .users-grid {
    grid-template-columns: 1fr;
  }
  
  .event-actions {
    flex-direction: column;
  }
  
  .modal {
    width: 95%;
    margin: 1rem;
  }
  
  .modal-footer {
    flex-direction: column;
  }

  .tabs-header {
    flex-direction: column;
  }

  .user-card {
    flex-direction: column;
    text-align: center;
  }

  .user-profile-header {
    flex-direction: column;
    text-align: center;
  }

  .user-profile-stats {
    justify-content: center;
  }

  .user-events-grid {
    grid-template-columns: 1fr;
  }
}
</style>
{% endblock %}
