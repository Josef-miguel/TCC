{% extends "base.html" %}

{% block content %}
<div class="container">
  <div class="card">
    <h3>Cadastrar Novo Evento</h3>
    <form id="eventoForm">
      <div class="form-group">
        <label for="title">Título</label>
        <input type="text" id="title" name="title" required class="form-control">
      </div>

      <div class="form-group">
        <label for="desc">Descrição</label>
        <textarea id="desc" name="desc" required class="form-control"></textarea>
      </div>

      <div class="form-group">
        <label for="price">Preço</label>
        <input type="number" id="price" name="price" required class="form-control">
      </div>

      <div class="form-group">
        <label for="numSlots">Número de vagas</label>
        <input type="number" id="numSlots" name="numSlots" required class="form-control">
      </div>

      <div class="form-group">
        <label for="exit_date">Data de saída</label>
        <input type="datetime-local" id="exit_date" name="exit_date" required class="form-control">
      </div>

      <div class="form-group">
        <label for="return_date">Data de retorno</label>
        <input type="datetime-local" id="return_date" name="return_date" required class="form-control">
      </div>

      <div class="form-group">
        <label for="type">Tipo</label>
        <select id="type" name="type" class="form-control">
          <option value="1">Passeio</option>
          <option value="2">Excursão</option>
          <option value="3">Viagem longa</option>
        </select>
      </div>

      <button type="submit" class="btn btn-primary">Cadastrar</button>
      <div id="formAlert" style="margin-top:12px"></div>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById("eventoForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const form = e.target;
  const data = {
    title: form.title.value,
    desc: form.desc.value,
    price: form.price.value,
    numSlots: form.numSlots.value,
    exit_date: form.exit_date.value,
    return_date: form.return_date.value,
    type: form.type.value
  };

  try {
    const resp = await fetch("/novo_evento", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    const result = await resp.json();
    const alertDiv = document.getElementById("formAlert");

    if (resp.ok && result.success) {
      alertDiv.innerHTML = `<div style="color:green">${result.message}</div>`;
      form.reset();
    } else {
      alertDiv.innerHTML = `<div style="color:red">${result.message}</div>`;
    }
  } catch (err) {
    console.error(err);
    document.getElementById("formAlert").innerHTML =
      `<div style="color:red">Erro na requisição</div>`;
  }
});
</script>
{% endblock %}
